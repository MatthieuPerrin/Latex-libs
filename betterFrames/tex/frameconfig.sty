% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{frameconfig}[2025/06/16 Package for making nice frames with tikz]

\RequirePackage{ccicons}
\RequirePackage{etoolbox} 
\RequirePackage{environ}

\RequirePackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{tikzmark,fit,backgrounds}


\newcommand\tf@if@empty[3]{\if#1\ \ #2\else#3\fi}

\tikzset{tf@style@tikz@added/.style={},}
\tikzset{tf@style@node@added/.style={},}
\tikzset{tf@style@tikz/.style={remember picture,overlay,shift={(current page.center)}}}
\tikzset{tf@style@node/.style={},}

\newcommand\tf@node@x{0}
\newcommand\tf@node@y{0}
\newcommand\tf@node@scale{1}
\newcommand\tf@image@height{}
\newcommand\tf@image@width{}
\newcommand\tf@image@title{}
\newcommand\tf@image@license{}
\newcommand\tf@image@img{}

\define@key{tf@node@options}{x}{\renewcommand\tf@node@x{#1}}
\define@key{tf@node@options}{y}{\renewcommand\tf@node@y{#1}}
\define@key{tf@node@options}{scale}{\renewcommand\tf@node@scale{#1}}
\define@key{tf@node@options}{text}[true]{\renewcommand\tf@node@x{0}\tikzset{tf@style@node@added/.append style={align=left, text width=\textwidth}}}
\define@key{tf@node@options}{width}{\tikzset{tf@style@node@added/.append style={align=left, text width=#1}}}
\define@key{tf@node@options}{top}[0]{\renewcommand\tf@node@y{3.5cm - #1}\tikzset{tf@style@node@added/.append style={anchor=north}}}
\define@key{tf@node@options}{bottom}[0]{\renewcommand\tf@node@y{-4.2cm + #1}\tikzset{tf@style@node@added/.append style={anchor=south}}}
\define@key{tf@node@options}{left}{\renewcommand\tf@node@x{.5 * #1 - \textwidth/2}\tikzset{tf@style@node@added/.append style={align=left, text width=#1}}}
\define@key{tf@node@options}{right}{\renewcommand\tf@node@x{\textwidth/2 - .5 * #1}\tikzset{tf@style@node@added/.append style={align=left, text width=#1}}}
\define@key{tf@node@options}{center}{\renewcommand\tf@node@x{0}\tikzset{tf@style@node@added/.append style={align=left, text width=#1}}}
\define@key{tf@node@options}{anchor}{\tikzset{tf@style@node@added/.append style={anchor=#1}}}
\define@key{tf@node@options}{align}{\tikzset{tf@style@node@added/.append style={align=#1}}}

\define@key{tf@image@options}{height}{\renewcommand\tf@image@height{#1}}
\define@key{tf@image@options}{width}{\renewcommand\tf@image@width{#1}}
\define@key{tf@image@options}{title}{\renewcommand\tf@image@title{#1}}
\define@key{tf@image@options}{license}{\renewcommand\tf@image@license{{}#1}}
\define@key{tf@image@options}{img}{\renewcommand\tf@image@img{#1}}

\newcommand<>\tf@draw[2]{%
  \begingroup%
  \tikzset{tf@style@tikz@added/.style={},}%
  \tikzset{tf@style@node@added/.style={},}%
  \setkeys{tf@node@options}{#1}%
  \begin{tikzpicture}[tf@style@tikz]%
    \node[tf@style@node, tf@style@node@added,scale=\tf@node@scale] at (\tf@node@x, \tf@node@y) {#2};%
  \end{tikzpicture}%
  \endgroup%
}

\newcommand\tf@image@missing[2]{%
  \begin{tikzpicture}
    \draw (0,0) rectangle +(#1,#2);
    \node[text width=#1,align=center] at (.5*#1,.5*#2) {%
      \textit{Missing image}\\%
      \small(non included for copyright issues)%
    };
  \end{tikzpicture}%
}

\newcommand\tf@image@draw[1]{%
  \begingroup%
  \setkeys{tf@image@options}{#1}%
  \begin{tabular}{@{}c@{}}%
    \ifdefined\Ginput@path\edef\input@path{\input@path\Ginput@path}\fi%
    \IfFileExists{\tf@image@img}{%
      \tf@if@empty\tf@image@height{%
        \tf@if@empty\tf@image@width{%
          \includegraphics{\tf@image@img}%
        }{%
          \includegraphics[width=\tf@image@width]{\tf@image@img}%
      }}{%
        \tf@if@empty\tf@image@width{%
          \includegraphics[height=\tf@image@height]{\tf@image@img}%
        }{%
          \includegraphics[height=\tf@image@height,width=\tf@image@width,keepaspectratio]{\tf@image@img}%
    }}}{%
      \tf@if@empty\tf@image@height{%
        \tf@if@empty\tf@image@width{%
          \tf@image@missing{2.5cm}{2.5cm}%
        }{%
          \tf@image@missing{\tf@image@width}{\tf@image@width}%
      }}{%
        \tf@if@empty\tf@image@width{%
          \tf@image@missing{\tf@image@height}{\tf@image@height}%
        }{%
          \tf@image@missing{\tf@image@width}{\tf@image@height}%
      }}
    }%
    \tf@if@empty\tf@image@title{}{\\\structure{\tf@image@title}}%
    \tf@if@empty\tf@image@license{}{\structure{\footnote{{}\tf@image@license}}}%
  \end{tabular}%
  \endgroup%
}

\newcommand<>\on[2][]{\only#3{\tf@draw{#1}{#2}}}
\newcommand<>\onBlock[3][]{\on#4[text,#1]{\begin{block}{#2}#3\end{block}}}
\newcommand<>\onAlertBlock[3][]{\on#4[text,#1]{\begin{alertblock}{#2}#3\end{alertblock}}}
\newcommand<>\onExampleBlock[3][]{\on#4[text,#1]{\begin{exampleblock}{#2}#3\end{exampleblock}}}
\newcommand<>\onImage[2][]{\on#3[#1]{\tf@image@draw{#2}}}

\newcommand<>\ob[2][]{\onlyb#3{\tf@draw{#1}{#2}}}
\newcommand<>\obBlock[3][]{\ob#4[text,#1]{\begin{block}{#2}#3\end{block}}}
\newcommand<>\obAlertBlock[3][]{\ob#4[text,#1]{\begin{alertblock}{#2}#3\end{alertblock}}}
\newcommand<>\obExampleBlock[3][]{\ob#4[text,#1]{\begin{exampleblock}{#2}#3\end{exampleblock}}}
\newcommand<>\obImage[2][]{\ob#3[#1]{\tf@image@draw{#2}}}

\newcommand<>\oh[2][]{\onlyh#3{\tf@draw{#1}{#2}}}
\newcommand<>\ohBlock[3][]{\oh#4[text,#1]{\begin{block}{#2}#3\end{block}}}
\newcommand<>\ohAlertBlock[3][]{\oh#4[text,#1]{\begin{alertblock}{#2}#3\end{alertblock}}}
\newcommand<>\ohExampleBlock[3][]{\oh#4[text,#1]{\begin{exampleblock}{#2}#3\end{exampleblock}}}
\newcommand<>\ohImage[2][]{\oh#3[#1]{\tf@image@draw{#2}}}

\endinput

