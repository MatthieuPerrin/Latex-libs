% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{grid}[2025/08/04 Package for grids in tikz]

\RequirePackage{xcolor}
\RequirePackage{keyval}
\RequirePackage{etoolbox}
\RequirePackage{xparse}
\RequirePackage{tikz}
\usetikzlibrary{automata}
\usetikzlibrary{overlay-beamer-styles}

\newcommand\grid@cell@width{6mm}
\newcommand\grid@cell@height{6mm}
\newcommand\grid@head@size{2mm}
\newcommand\grid@draw@nextCell{}
\newcommand\grid@array@name{}

\colorlet{grid@head@color}{black}
\colorlet{grid@fill@alert}{black!30}
\colorlet{grid@fill@example}{black!20}
\colorlet{grid@fill@structure}{black!10}

\tikzset{grid@fill@default/.style={fill=none},grid@style@path/.style={-latex}}
\tikzset{gridCloud/.style={anchor=mid, cloud, cloud puffs=11, cloud puff arc=120, aspect=2, inner ysep=1em},}

\tikzset{
  grid move north height/.code={
    \pgfinterruptboundingbox
    \path let\p1 = (grid@cell@current.south west),\p2 = (grid@cell@current.north east) in
    node[rectangle, text width=\dimexpr\x2-\x1\relax, text height=#1, inner sep=0pt, outer sep=0pt, anchor=south] (grid@cell@current) at (grid@cell@current.north) {};
    \endpgfinterruptboundingbox
  },
  grid move south height/.code={
    \pgfinterruptboundingbox
    \path let\p1 = (grid@cell@current.south west),\p2 = (grid@cell@current.north east) in
    node[rectangle, text width=\dimexpr\x2-\x1\relax, text height=#1, inner sep=0pt, outer sep=0pt, anchor=north] (grid@cell@current) at (grid@cell@current.south) {};
    \endpgfinterruptboundingbox
  },
  grid move east width/.code={
    \pgfinterruptboundingbox
    \path let\p1 = (grid@cell@current.south west),\p2 = (grid@cell@current.north east) in
    node[rectangle, text width=#1, text height=\dimexpr\y2-\y1\relax, inner sep=0pt, outer sep=0pt, anchor=west]  (grid@cell@current) at (grid@cell@current.east) {};
    \endpgfinterruptboundingbox
  },
  grid move west width/.code={
    \pgfinterruptboundingbox
    \path let\p1 = (grid@cell@current.south west),\p2 = (grid@cell@current.north east) in
    node[rectangle, text width=#1, text height=\dimexpr\y2-\y1\relax, inner sep=0pt, outer sep=0pt, anchor=east]  (grid@cell@current) at (grid@cell@current.west) {};
    \endpgfinterruptboundingbox
  },
  grid move north/.style={grid move north height={\dimexpr\y2-\y1\relax},},
  grid move south/.style={grid move south height={\dimexpr\y2-\y1\relax},},
  grid move east/.style= {grid move east width=  {\dimexpr\x2-\x1\relax},},
  grid move west/.style= {grid move west width=  {\dimexpr\x2-\x1\relax},},
  grid move/.style={grid move east,},
  every grid/.style={
    inner sep=0, outer sep=0,
    execute at begin scope={
      \pgfinterruptboundingbox
      \node[rectangle, fit={(0,0)(1,1)}, inner sep=0pt, outer sep=0pt] (grid@cell@current) at (0,0) {};
      \gridsave{grid@start@head}
      \gridsave{grid@lc@head}
      \endpgfinterruptboundingbox
    },
  },
  grid north/.style={every grid, grid move/.style={grid move north,},},
  grid south/.style={every grid, grid move/.style={grid move south,},},
  grid east/.style= {every grid, grid move/.style={grid move east,},},
  grid west/.style= {every grid, grid move/.style={grid move west,},},
  grid size/.style={node distance=#1, x=#1, y=#1,},
  width/.style={x=#1,},
  height/.style={y=#1,},
  grid/.style=grid east,
}


\tikzset{
  every cell fill/.style={fill highlighted,},
  cell fill/.style={every cell fill},
  every cell border/.style={draw highlighted,},
  cell border north/.style={every cell border,},
  cell border south/.style={every cell border,},
  cell border east/.style={every cell border,},
  cell border west/.style={every cell border,},
  every cell text/.style={text highlighted,},
  cell text/.style={every cell text, align=center,},
  %
  open north/.style={cell border north/.style={draw=none},},
  open south/.style={cell border south/.style={draw=none},},
  open east/.style={cell border east/.style={draw=none},},
  open west/.style={cell border west/.style={draw=none},},
  open/.style={open north, open south, open east, open west,},
  open both/.style={open before, open after,},
  cell dimension/.style={rectangle, minimum width=\grid@cell@width, minimum height=\grid@cell@height,},
  %
  cell draw/.code={
    \node[cell fill, draw=none, fit=(grid@cell@current), inner sep=0pt, outer sep=0pt] {};
    \draw[cell border north] (grid@cell@current.north west) -- (grid@cell@current.north east);
    \draw[cell border south] (grid@cell@current.south west) -- (grid@cell@current.south east);
    \draw[cell border east ] (grid@cell@current.south east) -- (grid@cell@current.north east);
    \draw[cell border west ] (grid@cell@current.south west) -- (grid@cell@current.north west);
  },
  cell/.style={
    inner sep=0pt,
    outer sep=0pt,
    cell draw,
    align=center,
    anchor=mid,
  },
}

\newcommand\cell[2][]{\node[grid move,#1,cell] at (grid@cell@current.center) {#2};}

\newcommand\gridsave[1]{\pgfnodealias{#1}{grid@cell@current}}

\endinput
